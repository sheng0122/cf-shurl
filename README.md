# Cloudflare çŸ­ç¶²å€ç³»çµ± (cf-shurl)

> ä½¿ç”¨ Cloudflare ç„¡ä¼ºæœå™¨æ¶æ§‹å»ºç«‹çš„å¤šåŸŸåçŸ­ç¶²å€ç³»çµ±

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Cloudflare Workers](https://img.shields.io/badge/Cloudflare-Workers-F38020?logo=cloudflare&logoColor=white)](https://workers.cloudflare.com/)

## ğŸ“– å°ˆæ¡ˆç°¡ä»‹

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Cloudflare ç”Ÿæ…‹ç³»çµ±å»ºç«‹çš„çŸ­ç¶²å€æœå‹™,å…·å‚™ä»¥ä¸‹ç‰¹è‰²:

- ğŸš€ **ç„¡ä¼ºæœå™¨æ¶æ§‹** - ä½¿ç”¨ Cloudflare Workers + KV + R2
- ğŸŒ **å¤šåŸŸåæ”¯æ´** - å¯åŒæ™‚ç®¡ç†å¤šå€‹å“ç‰Œçš„çŸ­ç¶²å€åŸŸå
- ğŸ¨ **è‡ªè¨‚ Open Graph** - æ§åˆ¶ç¤¾ç¾¤å¹³å°çš„é è¦½å‘ˆç¾
- ğŸ“± **QR Code ç”Ÿæˆ** - æ”¯æ´è‡ªè¨‚æ¨£å¼èˆ‡ Logo åµŒå…¥
- ğŸ’° **ä½æˆæœ¬é‹ç‡Ÿ** - å……åˆ†åˆ©ç”¨ Cloudflare å…è²»é¡åº¦
- ğŸ”’ **å®‰å…¨å¯é ** - ä½¿ç”¨ Cloudflare Access ä¿è­·ç®¡ç†å¾Œå°

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### çŸ­ç¶²å€ç®¡ç†
- è‡ªå‹•æˆ–æ‰‹å‹•ç”¢ç”ŸçŸ­ç¢¼
- æ”¯æ´è‡ªè¨‚çŸ­ç¶²å€
- ç·¨è¼¯ã€åˆªé™¤ã€æœå°‹åŠŸèƒ½
- åŸºæœ¬é»æ“Šçµ±è¨ˆ

### QR Code åŠŸèƒ½
- è‡ªå‹•ç”Ÿæˆ QR Code
- æ”¯æ´ PNG / SVG æ ¼å¼ä¸‹è¼‰
- è‡ªè¨‚é¡è‰²èˆ‡æ¨£å¼
- Logo åµŒå…¥åŠŸèƒ½

### Open Graph å„ªåŒ–
- è‡ªè¨‚ç¤¾ç¾¤é è¦½æ¨™é¡Œã€æè¿°ã€åœ–ç‰‡
- æ™ºèƒ½çˆ¬èŸ²åµæ¸¬
- æ”¯æ´ Facebookã€Twitterã€LINE ç­‰å¹³å°
- ä¸€èˆ¬ç”¨æˆ¶ç›´æ¥è·³è½‰,çˆ¬èŸ²è¿”å› OG é é¢

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½¿ç”¨è€…/çˆ¬èŸ²è«‹æ±‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çŸ­ç¶²å€åŸŸå         â”‚             â”‚   ç®¡ç†å¾Œå°åŸŸå       â”‚
â”‚   link.brand.com    â”‚             â”‚   admin.brand.com   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                   â”‚
            â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare Worker  â”‚             â”‚  Cloudflare Pages   â”‚
â”‚  - åµæ¸¬ User-Agent  â”‚             â”‚  (å‰ç«¯ + Functions) â”‚
â”‚  - ä¸€èˆ¬: redirect   â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  - çˆ¬èŸ²: å›å‚³ OG    â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
            â”‚                                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare KV     â”‚             â”‚   Cloudflare R2     â”‚
â”‚   (è³‡æ–™å„²å­˜)         â”‚             â”‚  (åœ–ç‰‡å„²å­˜)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ£§

| é¡åˆ¥ | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| é‹ç®— | Cloudflare Workers | çŸ­ç¶²å€ redirect + OG è™•ç† |
| å‰ç«¯è¨—ç®¡ | Cloudflare Pages | ç®¡ç†å¾Œå°ç¶²é  |
| å¾Œç«¯ API | Pages Functions | ç®¡ç† API ç«¯é» |
| è³‡æ–™åº« | Cloudflare KV | çŸ­ç¶²å€è³‡æ–™å„²å­˜ |
| æª”æ¡ˆå„²å­˜ | Cloudflare R2 | OG åœ–ç‰‡å„²å­˜ |
| èº«ä»½é©—è­‰ | Cloudflare Access | å¾Œå°ç™»å…¥ä¿è­· |

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

```
cf-shurl/
â”‚
â”œâ”€â”€ public/                      # å‰ç«¯éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ index.html               # ä¸»é é¢ï¼ˆDashboardï¼‰
â”‚   â”œâ”€â”€ create.html              # å»ºç«‹çŸ­ç¶²å€é é¢
â”‚   â”œâ”€â”€ list.html                # çŸ­ç¶²å€åˆ—è¡¨é é¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ app.js
â”‚       â”œâ”€â”€ api.js
â”‚       â”œâ”€â”€ qrcode.js
â”‚       â””â”€â”€ og-preview.js
â”‚
â”œâ”€â”€ functions/                   # Pages Functions (API)
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ links.js
â”‚       â”œâ”€â”€ links/
â”‚       â”‚   â””â”€â”€ [code].js
â”‚       â”œâ”€â”€ upload/
â”‚       â”‚   â””â”€â”€ image.js
â”‚       â””â”€â”€ og/
â”‚           â””â”€â”€ preview.js
â”‚
â”œâ”€â”€ worker/                      # Redirect Workerï¼ˆç¨ç«‹éƒ¨ç½²ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ bot-detect.js
â”‚   â”‚   â””â”€â”€ og-page.js
â”‚   â”œâ”€â”€ wrangler.toml
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ å¤šåŸŸåçŸ­ç¶²å€ç³»çµ±_PRD.md       # ç”¢å“éœ€æ±‚æ–‡ä»¶
â”œâ”€â”€ å¤šåŸŸåçŸ­ç¶²å€ç³»çµ±_æŠ€è¡“æ¡†æ¶.md   # æŠ€è¡“æ¡†æ¶æ–‡ä»¶
â”œâ”€â”€ wrangler.toml
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Node.js v18+
- npm æˆ– pnpm
- Cloudflare å¸³è™Ÿ
- è‡³å°‘ä¸€å€‹åŸŸåï¼ˆDNS è¨—ç®¡åœ¨ Cloudflareï¼‰

### å®‰è£æ­¥é©Ÿ

1. **å®‰è£ Wrangler CLI**

```bash
npm install -g wrangler
```

2. **ç™»å…¥ Cloudflare**

```bash
wrangler login
```

3. **å»ºç«‹ KV Namespace**

```bash
wrangler kv:namespace create "LINKS"
wrangler kv:namespace create "LINKS" --preview
```

4. **å»ºç«‹ R2 Bucket**

```bash
wrangler r2 bucket create url-shortener-images
```

5. **è¨­å®š wrangler.toml**

å°‡ç”¢ç”Ÿçš„ KV ID å¡«å…¥ `wrangler.toml` å’Œ `worker/wrangler.toml`

6. **æœ¬åœ°é–‹ç™¼**

```bash
# å•Ÿå‹•ç®¡ç†å¾Œå°
npx wrangler pages dev public

# å•Ÿå‹• Worker (å¦ä¸€å€‹çµ‚ç«¯)
cd worker
npx wrangler dev
```

7. **éƒ¨ç½²**

```bash
# éƒ¨ç½² Worker
cd worker
npx wrangler deploy

# éƒ¨ç½² Pages (æˆ–é€é GitHub è‡ªå‹•éƒ¨ç½²)
npx wrangler pages deploy public
```

## ğŸ“ ä½¿ç”¨èªªæ˜

### å»ºç«‹çŸ­ç¶²å€

1. ç™»å…¥ç®¡ç†å¾Œå°
2. é»æ“Šã€Œå»ºç«‹çŸ­ç¶²å€ã€
3. è¼¸å…¥é•·ç¶²å€
4. (å¯é¸) è‡ªè¨‚çŸ­ç¢¼
5. (å¯é¸) è¨­å®š Open Graph é è¦½
6. é»æ“Šã€Œå»ºç«‹ã€

### è‡ªè¨‚ Open Graph

åœ¨å»ºç«‹æˆ–ç·¨è¼¯çŸ­ç¶²å€æ™‚,å¯ä»¥è¨­å®š:

- **og:title** - é è¦½æ¨™é¡Œ
- **og:description** - é è¦½æè¿°
- **og:image** - é è¦½åœ–ç‰‡ (å¯ä¸Šå‚³æˆ–è¼¸å…¥ç¶²å€)
- **og:site_name** - ç¶²ç«™åç¨±

ç•¶çŸ­ç¶²å€è¢«åˆ†äº«åˆ°ç¤¾ç¾¤å¹³å°æ™‚,å¹³å°çˆ¬èŸ²æœƒçœ‹åˆ°è‡ªè¨‚çš„ OG å…§å®¹,è€Œä¸€èˆ¬ç”¨æˆ¶è¨ªå•å‰‡ç›´æ¥è·³è½‰åˆ°ç›®æ¨™ç¶²å€ã€‚

### ç”Ÿæˆ QR Code

æ¯å€‹çŸ­ç¶²å€éƒ½æœƒè‡ªå‹•ç”Ÿæˆ QR Code,å¯ä»¥:

- èª¿æ•´å°ºå¯¸
- è‡ªè¨‚é¡è‰²
- åµŒå…¥ Logo
- ä¸‹è¼‰ PNG æˆ– SVG æ ¼å¼

## ğŸ’° æˆæœ¬ä¼°ç®—

### Cloudflare å…è²»é¡åº¦

| é …ç›® | å…è²»é¡åº¦ | é ä¼°ä½¿ç”¨ |
|------|----------|----------|
| Workers è«‹æ±‚ | 100,000 æ¬¡/å¤© | < 100,000 |
| KV è®€å– | 100,000 æ¬¡/å¤© | < 100,000 |
| KV å¯«å…¥ | 1,000 æ¬¡/å¤© | < 100 |
| KV å„²å­˜ | 1 GB | < 100 MB |
| R2 å„²å­˜ | 10 GB/æœˆ | < 1 GB |

### é ä¼°æœˆè²»

å°æ–¼ä¸­å°å‹ä½¿ç”¨å ´æ™¯,å®Œå…¨å¯ä»¥åœ¨ Cloudflare å…è²»é¡åº¦å…§é‹è¡Œ,åƒ…éœ€æ”¯ä»˜åŸŸåè²»ç”¨ (ç´„ $10-15 USD/å¹´)ã€‚

## ğŸ“š æ–‡ä»¶

- [ç”¢å“éœ€æ±‚æ–‡ä»¶ (PRD)](./å¤šåŸŸåçŸ­ç¶²å€ç³»çµ±_PRD.md) - è©³ç´°çš„åŠŸèƒ½è¦æ ¼èˆ‡éœ€æ±‚
- [æŠ€è¡“æ¡†æ¶æ–‡ä»¶](./å¤šåŸŸåçŸ­ç¶²å€ç³»çµ±_æŠ€è¡“æ¡†æ¶.md) - å®Œæ•´çš„æŠ€è¡“å¯¦ä½œæŒ‡å—

## ğŸ”§ é–‹ç™¼æŒ‡ä»¤

| æŒ‡ä»¤ | ç”¨é€” |
|------|------|
| `npx wrangler pages dev public` | å•Ÿå‹• Pages æœ¬åœ°é–‹ç™¼ |
| `npx wrangler dev` | å•Ÿå‹• Worker æœ¬åœ°é–‹ç™¼ |
| `npx wrangler kv:key list --binding=LINKS` | åˆ—å‡º KV keys |
| `npx wrangler r2 object list url-shortener-images` | åˆ—å‡º R2 ç‰©ä»¶ |
| `npx wrangler deploy` | éƒ¨ç½² Worker |
| `npx wrangler pages deploy public` | æ‰‹å‹•éƒ¨ç½² Pages |
| `npx wrangler tail` | å³æ™‚æŸ¥çœ‹ Worker logs |

## ğŸ›¡ï¸ å®‰å…¨æ€§

- ä½¿ç”¨ Cloudflare Access ä¿è­·ç®¡ç†å¾Œå°
- è¼¸å…¥é©—è­‰èˆ‡ URL æ ¼å¼æª¢æŸ¥
- Rate Limiting é˜²æ­¢æ¿«ç”¨
- åƒ…å…è¨± http:// å’Œ https:// å”è­°

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue æˆ– Pull Request!

## ğŸ“„ æˆæ¬Š

MIT License

## ğŸ”— ç›¸é—œè³‡æº

- [Cloudflare Workers æ–‡ä»¶](https://developers.cloudflare.com/workers/)
- [Cloudflare KV æ–‡ä»¶](https://developers.cloudflare.com/kv/)
- [Cloudflare Pages æ–‡ä»¶](https://developers.cloudflare.com/pages/)
- [Cloudflare R2 æ–‡ä»¶](https://developers.cloudflare.com/r2/)
- [Open Graph Protocol](https://ogp.me/)

---

**æ³¨æ„**: é€™æ˜¯ä¸€å€‹å…§éƒ¨å·¥å…·å°ˆæ¡ˆ,ä¸æä¾›å…¬é–‹è¨»å†Šæœå‹™ã€‚å¦‚éœ€ä½¿ç”¨,è«‹è‡ªè¡Œéƒ¨ç½²åˆ°ä½ çš„ Cloudflare å¸³è™Ÿã€‚
